package net.nooj4nlp.controller.preferencesdialog;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.io.IOException;

import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.filechooser.FileNameExtensionFilter;

import net.nooj4nlp.engine.Constants;
import net.nooj4nlp.engine.Paths;
import net.nooj4nlp.gui.dialogs.PreferencesDialog;
import net.nooj4nlp.gui.main.Launcher;

import org.apache.commons.io.FileUtils;

public class ImportLexActionListener implements ActionListener
{

	private PreferencesDialog dialog = null;
	private UpdateDialogListener updateDialogListener;

	public ImportLexActionListener(PreferencesDialog dialog, UpdateDialogListener updateDialogListener)
	{
		this.dialog = dialog;
		this.updateDialogListener = updateDialogListener;
	}

	@Override
	public void actionPerformed(ActionEvent e)
	{
		File sourceFile = openFileDialog();
		if (sourceFile == null)
			return;
		String language = (String) dialog.getCbDefLanguage().getSelectedItem();
		String to = Paths.docDir + "\\" + language + "\\Lexical Analysis\\" + sourceFile.getName();

		File targetFile = new File(to);

		try
		{
			FileUtils.copyFile(sourceFile, targetFile);
		}
		catch (IOException e1)
		{
			JOptionPane.showMessageDialog(Launcher.getDesktopPane(), e1.getMessage(),
					Constants.ERROR_MESSAGE_TITLE_INPUT_OUTPUT_ERROR, JOptionPane.ERROR_MESSAGE);
			System.out.println("Greska u kopiranju " + e1.getMessage());
		}

		updateDialogListener.updateFromFormMainPreferences();
	}

	private File openFileDialog()
	{
		JFileChooser fileChooser = new JFileChooser();
		fileChooser.setDialogTitle("Open a grammar");
		FileNameExtensionFilter filterImportLex = new FileNameExtensionFilter(
				"Dictionaries (*.jnod; *.bin) Morphology (*.jnom; *.grm)", Constants.JNOD_EXTENSION, "bin", "nom",
				"grm");
		fileChooser.setFileSelectionMode(JFileChooser.FILES_ONLY);
		fileChooser.setAcceptAllFileFilterUsed(false);
		fileChooser.addChoosableFileFilter(filterImportLex);
		fileChooser.setFileFilter(filterImportLex);
		fileChooser.showOpenDialog(dialog);

		return fileChooser.getSelectedFile();
	}

}
